# Лабораторная работа №7

## Тема: "***<u>Асинхронное программирование</u>***"

### Цель:

- Знакомство с асинхронным программированием;
- Получение практических навыков в параллельной обработке данных;
- Получение практических навыков в синхронизации потоков;

### Порядок выполнения работы:

- Ознакомиться с теоретическим материалом

- Реализовать задание в соответствии с вариантом (Вариант 11)

- Подготовить тестовые наборы данных

- Отчитаться по выполненной работе путём демонстрации работающей программы на тестовых наборах данных (как подготовленных самостоятельно, так и предложенных преподавателем) и ответов на вопросы преподавателя (как из числа контрольных, так и по реализации программы).

### Требования к программе:

Модифицируйте вашу лабораторную работу №6 следующим образом:

- Должно быть реализовано три потока:
  
  - Поток, который осуществляет передвижение NPC на определенное расстояние (см. таблицу), а также определяет, что два NPC находятся на расстоянии убийства (см. таблицу). Если два NPC вступили в «бой», то он создает задачу для потока, осуществляющего бои.
  
  - Поток, который осуществляет бои. Если один npc может убивать другой, то каждый npc «кидает 6-гранный кубик» определяя силу атаки и силу защиты (соответственно). Если сила атаки больше, чем сила защиты – то происходит убийство.
  
  - Мертвые npc не передвигаются (у нас тут без некромантов).
  
  - Живые npc не могут покинуть карту (размер задается через константы, например 100 x 100)
  
  - Основной поток раз в секунду печатает карту. Мертвые npc на карте не отображаются.

- Осуществить контроль доступа к разделяемым ресурсов с помощью std::shared_lock и std::lock_guard

- Осуществить контроль к потоку вывода std::cout через std::lock_guard

- Потоки могут запускаться как std::thread с использованием лямбда функций или функторов (классов с перегруженным оператором operator())

- Вначале игры должно создаваться 50 npc в случайных локациях.

- Игра должна останавливаться через 30 секунд и выводить на экран список выживших

## Условие задачи (Вариант 11):

**Типы NPC:**

| Кто нагоняет          | Расстояние хода | Расстояние убийства |
|:---------------------:|:---------------:|:-------------------:|
| Друид                 | 10              | 10                  |
| Странствующий рыцарь  | 30              | 10                  |
| Эльф                  | 10              | 50                  |

**Правила боя:**
- Knight (Странствующий рыцарь) vs Elf (Эльф) → могут убить друг друга (кубик решает)
- Elf (Эльф) vs Druid (Друид) → Эльф может убить Друида
- Druid (Друид) vs Druid (Друид) → могут убить друг друга (кубик решает)
- В остальных случаях → ничья (никто не умирает)

**Механика боя:**
- Каждый участник бросает 6-гранный кубик
- Атакующий получает значение атаки, защищающийся — защиты
- Если атака > защита — происходит убийство

---

## Структура проекта

```
OOP_lab_6/
├── CMakeLists.txt
├── Dockerfile
├── docker-compose.yml
├── README.md
│
├── include/
│   ├── NPC.h
│   ├── Knight.h
│   ├── Druid.h
│   ├── Elf.h
│   ├── NPCFactory.h
│   ├── Visitor.h
│   ├── BattleVisitor.h
│   ├── Observer.h
│   ├── BattleQueue.h
│   └── DungeonEditor.h
│
├── src/
│   ├── main.cpp              # Интерактивная версия (ЛР6)
│   ├── main_async.cpp        # Асинхронная версия (ЛР7)
│   ├── Knight.cpp
│   ├── Druid.cpp
│   ├── Elf.cpp
│   └── Observer.cpp
│
└── tests/
    ├── test_main.cpp
    └── test_data.txt
```


**Windows (PowerShell):**

```powershell
# Создать директорию для сборки
mkdir build
cd build

# Конфигурация CMake
cmake ..

# Сборка всех целей
cmake --build .

# Запуск интерактивной версии (ЛР6)
.\dungeon_editor.exe

# Запуск асинхронной версии (ЛР7)
.\dungeon_async.exe

# Запуск тестов
.\dungeon_tests.exe
# или
ctest --verbose
```

**Linux/macOS:**

```bash
mkdir build && cd build
cmake ..
cmake --build .

./dungeon_editor    # Интерактивная версия
./dungeon_async     # Асинхронная версия
./dungeon_tests     # Тесты
```

### **Сборка через Docker**

```bash
# Сборка образа
docker build -t dungeon-game .

# Запуск асинхронной версии (ЛР7)
docker run -it dungeon-game

# Запуск интерактивной версии (ЛР6)
docker run -it dungeon-game ./dungeon_editor

# Запуск тестов
docker run --rm dungeon-game ./dungeon_tests
```

**Через docker-compose:**

```bash
docker-compose up --build
```


**Запуск тестов:**

```bash
cd build
ctest --verbose           # Через CTest
# или
./dungeon_tests          # Напрямую
```
